![image](https://user-images.githubusercontent.com/99112106/174266938-b32402a8-33e3-4f4b-81ab-5b0958889111.png)

# Basic Pentesting

## 1. Enumeration

We start with a simple scanning ports tool such as Nmap.

```
nmap -sV -A <IP>                                                                                 130 тип
Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-30 10:51 CEST
Nmap scan report for 10.10.89.210
Host is up (0.034s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.7
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.92%E=4%D=3/30%OT=22%CT=1%CU=38727%PV=Y%DS=2%DC=T%G=Y%TM=62441A2
OS:8%P=x86_64-pc-linux-gnu)SEQ(SP=F1%GCD=1%ISR=109%TI=Z%CI=I%II=I%TS=8)OPS(
OS:O1=M506ST11NW6%O2=M506ST11NW6%O3=M506NNT11NW6%O4=M506ST11NW6%O5=M506ST11
OS:NW6%O6=M506ST11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN(
OS:R=Y%DF=Y%T=40%W=6903%O=M506NNSNW6%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS
OS:%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=
OS:Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=
OS:R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T
OS:=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=
OS:S)

Network Distance: 2 hops
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h19m59s, deviation: 2h18m33s, median: 0s
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-time: 
|   date: 2022-03-30T08:51:50
|_  start_date: N/A
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2022-03-30T04:51:49-04:00

TRACEROUTE (using port 80/tcp)
HOP RTT      ADDRESS
1   33.48 ms 10.9.0.1
2   33.75 ms 10.10.89.210

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 29.10 seconds

```

We can see some interesting ports such as 22,80,445 etc.

* * *

## 2.Scanning Vulnerabilities on SMB

We have seen that port 445 is open so we are going to pass the nmap scripts specific to SMB. Hopefully we'll find something usefull.

```
nmap --script smb-vuln* -p 445 <IP>
Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-30 11:07 CEST
Nmap scan report for 10.10.89.210
Host is up (0.035s latency).

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
|_smb-vuln-ms10-061: false
|_smb-vuln-ms10-054: false
| smb-vuln-regsvc-dos: 
|   VULNERABLE:
|   Service regsvc in Microsoft Windows systems vulnerable to denial of service
|     State: VULNERABLE
|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference
|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes
|       while working on smb-enum-sessions.
|_          

Nmap done: 1 IP address (1 host up) scanned in 9.98 seconds

```

As we can see, the host is vulnerable to DoS wich can not offer us usefull information. Let's try to enumerate some users with **enum4linux**.

```
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''                                                                
S-1-22-1-1000 Unix User\kay (Local User)                                                                            
S-1-22-1-1001 Unix User\jan (Local User)

```

Bam. We have managed to list 2 users; ***kay*** and ***jan***.

*** 
## 3.Scanning Vulnerabilities on Apache
We can see that Apache is running on port 80, Apache Jserv on port 8009 and Apache Tomcat on 8080. So first, we'll visit the default HTTP port:

![image](https://user-images.githubusercontent.com/99112106/174267034-258ab36c-6689-4886-b2ae-1e116e9d17e3.png)

Let's use **gobuster** to search hidden directories:

```
gobuster dir -w /usr/share/dirb/wordlists/big.txt -u http://10.10.89.210             
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.89.210
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/dirb/wordlists/big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/03/30 12:10:07 Starting gobuster in directory enumeration mode
===============================================================
/.htpasswd            (Status: 403) [Size: 296]
/.htaccess            (Status: 403) [Size: 296]
/development          (Status: 301) [Size: 318] [--> http://10.10.89.210/development/]
/server-status        (Status: 403) [Size: 300]                                       
                                                                                      
===============================================================
2022/03/30 12:11:28 Finished
===============================================================

```

We have found the "development" directory so let's visit it:

![image](https://user-images.githubusercontent.com/99112106/174267138-939066c4-3548-4cfb-bc0c-498be76f160b.png)

We found two txt files in that directory:
- Dev.txt:

![image](https://user-images.githubusercontent.com/99112106/174267187-142f82ac-d57d-434a-8bf9-836830e556a3.png)

- J.txt:

![image](https://user-images.githubusercontent.com/99112106/174267220-9c9bd3b6-53f2-4a43-88ae-36914ab29ba8.png)

* * *

## 4.Cracking with Hydra
We find the initials K and J corresponding to the users we have managed to list above. In one of the notes we can see that it says that Jan's password is easily crackable, so we are going to use **hydra** to crack it and enter via SSH with Jan.

![image](https://user-images.githubusercontent.com/99112106/174267354-24e04946-d458-4f5c-9458-361b8d0f0c10.png)
* * *

## 5. Access via SSH
Finally, after a long wait, we managed to get Jan's password account. Let's login via SSH:

![image](https://user-images.githubusercontent.com/99112106/174267387-663a6969-6d5d-43dc-9a4f-2057509fa7c6.png)
* * *

## 6. Privilege Escalation
Now that we have access to Jan's account, let's run the linpeas script that will give us an idea of the possible attack vectors we can take advantage of. We set up an HTTP server with python on our host:

![image](https://user-images.githubusercontent.com/99112106/174267431-21f68329-b65e-421b-9f6d-b8f1f7cf89a0.png)

And now with the wget command we ask for the script:

![image](https://user-images.githubusercontent.com/99112106/174267468-bca95e70-3e51-4abd-ae22-de60a59a18d1.png)

Once we have it, we give it execution permissions and run it.

![image](https://user-images.githubusercontent.com/99112106/174267494-da4e0bf8-d85b-4c1f-954e-781a57ced6f2.png)

We found several attack vectors such as CVEs, cron jobs, binary processes and files that could be of interest for horizontal scaling to other users such as Kay's id_rsa. This would allow us for example to access via SSH with the user Kay:

![image](https://user-images.githubusercontent.com/99112106/174267585-e5d8a37b-f733-4ca1-a320-094ab3a1d66c.png)

We have access to both private and public keys:

![image](https://user-images.githubusercontent.com/99112106/174267615-b13de4fd-da3c-48f8-8d02-2a3e9474c19f.png)

We could try to abuse this but I think it's more effective to try privilege escalation directly with the Pwnkit vulnerability (CVE-2021-4034) detected by Linpeas. We download Pwnkit from its official repository and once again, we pass the file to the vulnerable machine via an HTTP server set up with Python.

![image](https://user-images.githubusercontent.com/99112106/174267670-90e6da56-37ac-4bca-814c-62bc67b1f2aa.png)

We just execute it and get root access. Just like that.

![image](https://user-images.githubusercontent.com/99112106/174267764-00e71611-e7de-4a0e-a302-c19d9490614a.png)

Now we can access the **final root flag**: 

![image](https://user-images.githubusercontent.com/99112106/174267832-2f966aed-a1f7-42ca-a283-24a7f6edda5b.png)
